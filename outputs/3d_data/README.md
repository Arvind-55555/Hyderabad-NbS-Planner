# 3D Data for SpatialBound 4D Visualization

This directory contains 3D data files generated for SpatialBound 4D visualization.

## Generated Files

### CityJSON Files (3D Building Data)

**Format**: CityJSON 1.1  
**Coordinate System**: WGS84 (EPSG:4326)

- `*_BEFORE.json` - Current state with existing buildings and green spaces
- `*_AFTER.json` - Future state with NbS interventions

### 3D GeoJSON Files

**Format**: GeoJSON with Z-coordinates

- `*_buildings_3d.geojson` - Buildings with height as third coordinate
- `*_nbs_3d.geojson` - NbS interventions with heights

### Project Information

- `spatialbound_project_info.json` - SpatialBound project metadata
  - Project ID
  - Viewer URL
  - Embed code

## How to Generate

```bash
# Generate 3D data only (no upload)
python tools/generate_3d_data.py --no-upload

# Generate and upload to SpatialBound
python tools/generate_3d_data.py --project-name "Your Project Name"
```

## File Structure

```
3d_data/
â”œâ”€â”€ README.md                           # This file
â”œâ”€â”€ ProjectName_BEFORE.json             # CityJSON - Current state
â”œâ”€â”€ ProjectName_AFTER.json              # CityJSON - With NbS
â”œâ”€â”€ ProjectName_buildings_3d.geojson    # 3D GeoJSON - Buildings
â”œâ”€â”€ ProjectName_nbs_3d.geojson          # 3D GeoJSON - NbS
â””â”€â”€ spatialbound_project_info.json      # Project metadata
```

## Viewing the Data

### Option 1: SpatialBound Viewer (Recommended)
After uploading, access the 4D viewer at the URL in `spatialbound_project_info.json`

### Option 2: Streamlit Dashboard
```bash
streamlit run web_app.py
```
Navigate to "ðŸŽ¬ 4D Visualization" tab

### Option 3: GIS Software
Import the 3D GeoJSON files into QGIS, ArcGIS, or other GIS software

### Option 4: CityJSON Viewer
Use online viewer: https://ninja.cityjson.org/

## Data Specifications

### Buildings (BEFORE & AFTER)
- **Type**: Solid geometry (3D volumes)
- **Height**: From `avg_height` attribute
- **LOD**: Level of Detail 1
- **Attributes**: height, roof_type, function, temporal_state

### NbS Interventions (AFTER only)
- **Type**: MultiSurface (3D surfaces)
- **Height**: Varies by NbS type
  - Green Roof: Building height + 0.5m
  - Urban Forest: 8m (average tree height)
  - Ground level: 0.2m
- **LOD**: Level of Detail 1
- **Attributes**: nbs_type, area_sqm, cost_inr, temporal_state

## Temporal States

- **BEFORE**: Current infrastructure (baseline)
- **AFTER**: With NbS interventions (future scenario)

The 4D visualization shows smooth transition between these states.

## File Sizes

Typical file sizes for 1.5km radius analysis:
- CityJSON BEFORE: ~2-5 MB
- CityJSON AFTER: ~3-7 MB
- 3D GeoJSON: ~1-3 MB each

## Troubleshooting

### Large File Sizes
If files are too large (>10 MB):
1. Reduce analysis radius: `python main.py --radius 1000`
2. Increase grid cell size: `python main.py --grid-size 200`
3. Simplify geometries in the source data

### Invalid CityJSON
Validate your CityJSON files:
```bash
pip install cjio
cjio ProjectName_BEFORE.json validate
```

### Missing Data
If 3D data generation fails:
1. Ensure analysis completed: `python main.py`
2. Check for output files: `ls -la outputs/reports/`
3. Verify building heights exist in data

## Technical Details

### Coordinate Transformation
- Input: WGS84 (EPSG:4326) lat/lon
- Processing: UTM Zone 44N (EPSG:32644) for accurate measurements
- Output: WGS84 (EPSG:4326) for compatibility

### Vertex Optimization
- Duplicate vertices are merged
- Vertex indices are reused
- Results in smaller file sizes

### Geometry Types
- **Solid**: 3D volumes (buildings)
- **MultiSurface**: 3D surfaces (NbS interventions)
- **PlantCover**: Vegetation (trees, green roofs)
- **WaterBody**: Water features (wetlands)
- **LandUse**: Ground surfaces (permeable pavement)

## References

- **CityJSON**: https://www.cityjson.org/
- **SpatialBound**: https://www.spatialbound.com/doc
- **3D Tiles**: https://github.com/CesiumGS/3d-tiles

## Support

For issues with 3D data generation:
- Check logs: `python tools/generate_3d_data.py 2>&1 | tee generation.log`
- Review documentation: `docs/SPATIALBOUND_INTEGRATION.md`
- Open issue: https://github.com/Arvind-55555/Hyderabad-NbS-Planner/issues

---

**Generated by**: Hyderabad NbS Planner  
**Version**: 1.0  
**Last Updated**: December 2025

